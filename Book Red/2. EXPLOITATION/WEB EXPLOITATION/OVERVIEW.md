# Web Attacks!
## General Process:  

	  Always try to Find the Application Version!!
	  Tools:
	    burpsuite (set up w/ foxyproxy extension)
	    cookie editor extension
	  Things to Check:
		Source code
			comments, urls, hard-coded credentials, functions, etc.
		Browser Dev Tools->Network Headers->Response Headers->server versions, etc.
		Cookies
		Requests & responses in burpsuite -> try to break things & produce errors
		Input boxes:
			code injection ( ; id)
			sql injection (' or ")
			xss (<script>alert(‘XSS’)</script>)
		URLs: look for strange parameters, file extensions, etc.
		Anywhere to edit content? - php themes, etc.
		Anywhere to upload files? - profile picture, plugins, etc.  
	Web Roots:
		Linux: /var/www/html
		FreeBSD: /usr/local/www/apache24/data
	Apache Vhosts File:  /etc/apache2/sites-enabled/000-default.conf
	Nginx Vhosts File:  /etc/nginx/sites-enabled/default
	OpenBSD httpd config file:  /etc/httpd.conf

## Blackbox Approach:

    Start Scanners:
        sudo env "PATH=$PATH" autorecon <IP>
    Quick open-source research - known application? known exploits?
    Check Wappalyzer
    Browse through Burp intercept - test ALL functionality (click all links, create account, login, reset password, etc.)
        Use Wappalyzer to check languages
        Note interesting requests/parameters
        Monitor cookies along the way
        Watch for mass assignment opportunities (signup, API interaction, etc.)
        Watch for JSON payloads - NodeJS prototype pollution?
    Find application documentation
    Check 404 format: GET /fakepage
    Review site map in Burp - any interesting folders?
        Compare with Autorecon results
        *Any endpoints/features that shouldn't be unauthenticated?
        What features do we have access to? - dig deeper - rescan?
        *Look for 302 results with non-0 size! - PHP script might not be properly terminated
    *Identify Data Entry Points
        URLs, parameters, POST data, cookies, headers, API, etc.
        Understand session management
            Check cookies - what is set and when?
        Look at all HTTP parameters, headers, cookies, etc. - *Especially anything encoded
            Anything decodable (base64, etc.)? Predictable?
    Understand the functionality
        What libraries? Any known vulnerabilities?
        Identify technologies used
    Map the Attack Surface - what pages interact with what backend features?
    Review API functionality
    Review Documentation!
        Reference documentation/examples for sample HTTP requests - figure out what parameters/headers you need to reach the endpoint
    Skim the HTML of main/critical pages - any comments, hard-coded credentials/keys, etc.?
        
	THINGS TO LOOK FOR:
		Database Interaction:
			Queries/information retrieval (login, page selection, etc.):
				SQLI
			Data insertion/modification:
				Mass Assignment/Parameter Binding (signup pages)
			Concatenated user input (instead of paramaterizing)
		Login Pages:
			SQLI
			PHP Type Juggling (==)
		User Input Reflection:
			XSS
			SSTI
		File Upload:
			insecure checks - upload webshell
		XML Parsing - XXE:
			APIs, etc.
		Templates/Rendering - SSTI

## Manual Attack Vectors:

	***** AUTHENTICATION BYPASS METHODS *****
		Goal: gain session/cookie/token/password
		SQLI
			read file
			read creds/password/hash
				then crack or bypass via logic error
			read password reset token
			read admin/auth token
			Insert new user/change user password
		XSS
			steal admin cookie/session
				Reflected - phishing link
				Stored - just access the page
			CSRF - Session Stealing or Session Riding
				XHR or fetch: send request, copy links, scrape html content, pull CSRF token from another page, pull API/websocket key, etc.
			HTML files - if dynamically generated, look for traditional reflected or stored XSS; otherwise DOM-based through Javascript
		PHP Type Juggling
		SSRF
			ex. calling internal Admin API key endpoint
		API Interaction
			LFI
			XXE
			Other improper input validation and processing
			Admin API key endpoint
		Insecure Token Generation (brute-forcing)
		XXE
			read file w/ Tomcat credentials, admin key, etc.
			*List directory contents
			CSRF
		CSRF/CORS - with or without XSS (host direct payload page)
			Send request to another endpoint
		Hardcoded credentials/keys/tokens/API keys - use to access API, or login to the app
		Auth Token/Cookie Manipulation
		Prototype Pollution (NodeJS)
			ex. setting isAdmin globally
		Deserialization
			-> PHP Type Juggling
			-> SQLI
		LFI/Directory Traversal

	*** REMOTE CODE EXECUTION METHODS ***
		SQLI
			UDF (PostgreSQL, HSQLDB, MySQL)
				PostgreSQL: via .dll that's either shared or written to disk
				HSQLDB: via calling Java routine and writing webshell
			Write file
				Overwrite locally-run application script/startup file (use ProcMon) w/ msfvenom revshell (ex. .vbs or .bat)
				Create webshell
		Deserialization
			ex. Use gadget to create webshell file; command execution
			-> SQLI
		File Uploads
			Upload a webshell or reverse shell
			https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Upload%20Insecure%20Files
			Tips:
				Might need to trigger error (break application) to store file
				Try to trigger directory traversal with file name
				Filter bypass method:  max length truncation
			Tomcat WAR file upload
			Trick: if you can upload arbitrary files (by name), but not PHP files, upload new .htaccess first:  "AddType application/x-httpd-php .abc" - then upload a php file as .abc file
		Plugins - upload/activation/creative usage/command injection/sqli/etc.
		SSTI
			Look for if the app uses a templating engine!
			Ability to edit templates/add new templates?
		XXE (if PHP enabled)
		Prototype Pollution (NodeJS)
			can also cause XSS
		SSRF (API Gateway?)
		Code Injection - Javascript or OS commands
			ex. NodeJS/Javascript/PHP - eval
			ex. Websockets - poor input parsing
		CSRF/CORS - with or without XSS (host direct payload page)
			Send request to another endpoint
			ex. Add plugin; initialize SQL query; inject content (SSTI, XXE, etc.); Change settings/weaken posture
		API Interaction
			ex. CSRF/CORS to submit a process/flow request with reverse shell (Concord)
			ex. Adding a new plugin with revshell code (APIGateway)

## Example Enumeration Commands:

	Endpoint Enumeration:
		gobuster dir -u http://192.168.169.135:8000 -w /usr/share/wordlists/dirbuster/directory-list-1.0.txt -s "200,204,301,302,307,401,403,405,500"
				Cleanup:  sort endpoints.txt | cut -d" " -f1 | cut -d"/" -f2 > endpoints_sorted.txt
		Gobuster through Burp:  gobuster dir -u http://192.168.169.135:8000 -w endpoints_sorted.txt --proxy http://127.0.0.1:8080
		wfuzz -c -w /usr/share/seclists/Discovery/Web-Content/burp-parameter-names.txt --hc 404  http://10.10.10.128:6666/FUZZ
		gobuster -u http://admin.hackback.htb/js/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-small.txt -x js -t 50
		gobuster -u http://admin.hackback.htb/2bb6916122f1da34dcd916421e531578/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-small.txt -x php -t 50
		Subdomains:
			wfuzz -c -w /usr/share/seclists/Discovery/DNS/subdomains-top1mil-5000.txt -H "Host: FUZZ.nestedflanders.htb" --hh 2 https://10.10.10.126
			wfuzz -c -w /usr/share/seclists/Discovery/Web-Content/burp-parameter-names.txt -H "Host: FUZZ.mango.htb" --hh 5152 https://10.10.10.162/

	Parameter/Login Fuzzing:
		wfuzz -c -w /opt/SecLists/Usernames/Names/names.txt -d "username=FUZZ&password=abcd" -u http://10.10.10.73/login.php [--hh 7074]
		wfuzz -c -w /usr/share/seclists/Passwords/darkweb2017-top1000.txt --hw 0 --hh 17 'http://admin.hackback.htb//2bb6916122f1da34dcd916421e531578/webadmin.php?action=list&site=hackthebox&password=FUZZ&session='
		wfuzz -u http://10.10.10.62:4/index.php?page=FUZZ -w /usr/share/seclists/Discovery/Web-Content/burp-parameter-names.txt --hh 110
		Origin/CORS fuzzing:  wfuzz -u http://gym-club.crossfit.htb/ -H "Origin: http://FUZZ.crossfit.htb" --filter "r.headers.response ~ 'Access-Control-Allow-Origin'" -w /opt/SecLists/Discovery/DNS/bitquark-subdomains-top
		API Methods:  
			GET:  wfuzz -u http://crossfit-club.htb/api/FUZZ -w /usr/share/seclists/Discovery/DNS/subdomains-top1million-20000.txt --hc 404
			POST:  wfuzz -X POST -u http://crossfit-club.htb/api/FUZZ -w /usr/share/seclists/Discovery/DNS/subdomains-top1million-20000.txt --hc 404

